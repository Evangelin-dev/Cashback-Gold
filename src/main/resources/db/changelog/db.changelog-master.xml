<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <!-- Temporary OTP Table -->
    <changeSet id="1" author="azeem">
        <createTable tableName="otp_verification">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true"/>
            </column>
            <column name="identifier" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="otp" type="VARCHAR(10)">
                <constraints nullable="false"/>
            </column>
            <column name="expires_at" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="verified" type="BOOLEAN" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"/>
        </createTable>
    </changeSet>

<!--    &lt;!&ndash; Users Table &ndash;&gt;-->
<!--    <changeSet id="2" author="azeem">-->
<!--        <createTable tableName="users">-->
<!--            <column name="id" type="BIGSERIAL">-->
<!--                <constraints primaryKey="true"/>-->
<!--            </column>-->
<!--            <column name="full_name" type="VARCHAR(100)">-->
<!--                <constraints nullable="false"/>-->
<!--            </column>-->
<!--            <column name="gender" type="VARCHAR(20)">-->
<!--                <constraints nullable="false"/>-->
<!--            </column>-->
<!--            <column name="dob" type="DATE">-->
<!--                <constraints nullable="false"/>-->
<!--            </column>-->
<!--            <column name="email" type="VARCHAR(255)">-->
<!--                <constraints nullable="false" unique="true"/>-->
<!--            </column>-->
<!--            <column name="mobile" type="VARCHAR(20)">-->
<!--                <constraints nullable="false" unique="true"/>-->
<!--            </column>-->
<!--            <column name="country_code" type="VARCHAR(10)">-->
<!--                <constraints nullable="false"/>-->
<!--            </column>-->
<!--            <column name="city" type="VARCHAR(100)">-->
<!--                <constraints nullable="false"/>-->
<!--            </column>-->
<!--            <column name="town" type="VARCHAR(100)">-->
<!--                <constraints nullable="false"/>-->
<!--            </column>-->
<!--            <column name="state" type="VARCHAR(100)">-->
<!--                <constraints nullable="false"/>-->
<!--            </column>-->
<!--            <column name="country" type="VARCHAR(100)">-->
<!--                <constraints nullable="false"/>-->
<!--            </column>-->
<!--            <column name="password" type="VARCHAR(255)">-->
<!--                <constraints nullable="false"/>-->
<!--            </column>-->
<!--            <column name="role" type="VARCHAR(50)">-->
<!--                <constraints nullable="false"/>-->
<!--            </column>-->
<!--            <column name="status" type="VARCHAR(20)" defaultValue="PENDING">-->
<!--                <constraints nullable="false"/>-->
<!--            </column>-->
<!--            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"/>-->
<!--            <column name="updated_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"/>-->
<!--        </createTable>-->
<!--    </changeSet>-->

<!--    <changeSet id="3" author="cseazeem">-->
<!--        <sql>-->
<!--            ALTER TABLE users ADD CONSTRAINT chk_user_role-->
<!--                CHECK (role IN ('ADMIN', 'PARTNER', 'B2B', 'USER'));-->
<!--        </sql>-->
<!--    </changeSet>-->

<!--    <changeSet id="3-1" author="cseazeem">-->
<!--        <sql>-->
<!--            ALTER TABLE users ADD CONSTRAINT chk_user_status-->
<!--                CHECK (status IN ('PENDING', 'APPROVED', 'REJECTED'));-->
<!--        </sql>-->
<!--    </changeSet>-->

    <!-- Users Table -->
    <changeSet id="2" author="azeem">
        <createTable tableName="users">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true"/>
            </column>
            <column name="full_name" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="gender" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="dob" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="VARCHAR(255)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="mobile" type="VARCHAR(20)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="country_code" type="VARCHAR(10)">
                <constraints nullable="false"/>
            </column>
            <column name="city" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="town" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="state" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="country" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="password" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="role" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(20)" defaultValue="PENDING">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="updated_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Add role constraint -->
    <changeSet id="3" author="cseazeem">
        <sql>
            ALTER TABLE users ADD CONSTRAINT chk_user_role
                CHECK (role IN ('ADMIN', 'PARTNER', 'B2B', 'USER'));
        </sql>
    </changeSet>

    <!-- Add status constraint -->
    <changeSet id="3-1" author="cseazeem">
        <sql>
            ALTER TABLE users ADD CONSTRAINT chk_user_status
                CHECK (status IN ('PENDING', 'APPROVED', 'REJECTED'));
        </sql>
    </changeSet>

    <!-- KYC Documents Table -->
    <changeSet id="3-2" author="azeem">
        <createTable tableName="kyc_documents">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="fk_kyc_user" references="users(id)"/>
            </column>
            <column name="user_type" type="VARCHAR(20)"/>
            <column name="status" type="VARCHAR(20)" defaultValue="PENDING">
                <constraints nullable="false"/>
            </column>
            <column name="aadhar_url" type="TEXT"/>
            <column name="pan_url" type="TEXT"/>
            <column name="gst_certificate_url" type="TEXT"/>
            <column name="pan_card_url" type="TEXT"/>
            <column name="address_proof_url" type="TEXT"/>
            <column name="bank_statement_url" type="TEXT"/>
            <column name="submitted_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Add status constraint for kyc_documents -->
    <changeSet id="3-3" author="azeem">
        <sql>
            ALTER TABLE kyc_documents ADD CONSTRAINT chk_kyc_status
                CHECK (status IN ('PENDING', 'APPROVED', 'REJECTED'));
        </sql>
    </changeSet>

    <!-- Add indexes for performance -->
    <changeSet id="3-4" author="azeem">
        <createIndex tableName="users" indexName="idx_users_email">
            <column name="email"/>
        </createIndex>
        <createIndex tableName="users" indexName="idx_users_mobile">
            <column name="mobile"/>
        </createIndex>
        <createIndex tableName="kyc_documents" indexName="idx_kyc_user_id">
            <column name="user_id"/>
        </createIndex>
        <createIndex tableName="kyc_documents" indexName="idx_kyc_user_type">
            <column name="user_type"/>
        </createIndex>
    </changeSet>

<!--    <changeSet id="4" author="azeem">-->
<!--        <insert tableName="users">-->
<!--            <column name="full_name" value="Admin User"/>-->
<!--            <column name="gender" value="male"/>-->
<!--            <column name="dob" value="1990-01-01"/>-->
<!--            <column name="email" value="admin@example.com"/>-->
<!--            <column name="mobile" value="+919999999999"/>-->
<!--            <column name="country_code" value="+91"/>-->
<!--            <column name="city" value="Admin City"/>-->
<!--            <column name="town" value="Admin Town"/>-->
<!--            <column name="state" value="Admin State"/>-->
<!--            <column name="country" value="Admin Country"/>-->
<!--            <column name="password" value="$2a$10$2FW0Fob1PaYrgoR6h0/8EeTmVr.fgMI4n04Pqba7crwFPSFb.Kgzm"/> &lt;!&ndash; password: password123 &ndash;&gt;-->
<!--            <column name="role" value="ADMIN"/>-->
<!--            <column name="status" value="APPROVED"/>-->
<!--            <column name="created_at" valueDate="NOW()"/>-->
<!--            <column name="updated_at" valueDate="NOW()"/>-->
<!--        </insert>-->
<!--    </changeSet>-->

    <!-- Insert Admin User -->
    <changeSet id="4" author="azeem">
        <insert tableName="users">
            <column name="full_name" value="Admin User"/>
            <column name="gender" value="male"/>
            <column name="dob" value="1990-01-01"/>
            <column name="email" value="admin@example.com"/>
            <column name="mobile" value="+919999999999"/>
            <column name="country_code" value="+91"/>
            <column name="city" value="Admin City"/>
            <column name="town" value="Admin Town"/>
            <column name="state" value="Admin State"/>
            <column name="country" value="Admin Country"/>
            <column name="password" value="$2a$10$2FW0Fob1PaYrgoR6h0/8EeTmVr.fgMI4n04Pqba7crwFPSFb.Kgzm"/>
            <column name="role" value="ADMIN"/>
            <column name="status" value="APPROVED"/>
            <column name="created_at" valueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" valueComputed="CURRENT_TIMESTAMP"/>
        </insert>
    </changeSet>

    <changeSet id="5" author="azeem">
        <createTable tableName="ornaments">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="price" type="DECIMAL(10,2)">
                <constraints nullable="false"/>
            </column>
            <column name="category" type="VARCHAR(100)"/>
            <column name="sub_category" type="VARCHAR(100)"/>
            <column name="gender" type="VARCHAR(20)"/>
            <column name="description1" type="TEXT"/>
            <column name="description2" type="TEXT"/>
            <column name="description3" type="TEXT"/>
            <column name="description" type="TEXT"/>
            <column name="main_image" type="TEXT"/>
            <column name="sub_image1" type="TEXT"/>
            <column name="sub_image2" type="TEXT"/>
            <column name="sub_image3" type="TEXT"/>
            <column name="sub_image4" type="TEXT"/>
            <column name="material" type="VARCHAR(100)"/>
            <column name="purity" type="VARCHAR(100)"/>
            <column name="quality" type="VARCHAR(100)"/>
            <column name="details" type="TEXT"/>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"/>
        </createTable>
    </changeSet>

    <changeSet id="5-1" author="azeem">
        <createTable tableName="price_breakups">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="ornament_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="fk_price_breakup_ornament" references="ornaments(id)"/>
            </column>
            <column name="component" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="gold_rate_18kt" type="DECIMAL(10,2)">
                <constraints nullable="false"/>
            </column>
            <column name="weight_g" type="DECIMAL(10,2)">
                <constraints nullable="false"/>
            </column>
            <column name="discount" type="DECIMAL(10,2)">
                <constraints nullable="false"/>
            </column>
            <column name="final_value" type="DECIMAL(10,2)">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"/>
        </createTable>
    </changeSet>

<!--    <changeSet id="6" author="azeem">-->
<!--        <createTable tableName="kyc_documents">-->
<!--            <column name="id" type="BIGSERIAL">-->
<!--                <constraints primaryKey="true" nullable="false"/>-->
<!--            </column>-->
<!--            <column name="user_id" type="BIGINT"/>-->
<!--            <column name="type" type="VARCHAR(20)"/>-->
<!--            <column name="status" type="VARCHAR(20)" defaultValue="PENDING"/>-->
<!--            <column name="aadhar_or_gst_url" type="TEXT"/>-->
<!--            <column name="pan_or_agreement_url" type="TEXT"/>-->
<!--            <column name="submitted_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"/>-->
<!--        </createTable>-->
<!--    </changeSet>-->

<!--    <changeSet id="6-1" author="azeem">-->
<!--        <sql>-->
<!--            ALTER TABLE kyc_documents ADD CONSTRAINT chk_kyc_documents_status-->
<!--                CHECK (status IN ('PENDING', 'APPROVED', 'REJECTED'));-->
<!--        </sql>-->
<!--    </changeSet>-->

    <changeSet id="7" author="azeem">
        <createTable tableName="marketing_resources">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="title" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="file_name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="file_type" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="file_url" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="upload_date" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="download_count" type="INT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="7-1" author="azeem">
        <sql>
            ALTER TABLE marketing_resources ADD CONSTRAINT chk_marketing_resources_status
                CHECK (status IN ('ACTIVE','INACTIVE'));
        </sql>
    </changeSet>

    <changeSet id="8" author="azeem">
        <createTable tableName="sip_plans">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" />
            </column>
            <column name="name" type="VARCHAR(255)"/>
            <column name="tenure" type="VARCHAR(100)"/>
            <column name="monthly_amount" type="VARCHAR(100)"/>
            <column name="description" type="TEXT"/>
            <column name="status" type="VARCHAR(50)"/>
        </createTable>
    </changeSet>

    <changeSet id="8-1" author="azeem">
        <sql>
            ALTER TABLE sip_plans ADD CONSTRAINT chk_sip_plans_status
                CHECK (status IN ('ACTIVE','CLOSED'));
        </sql>
    </changeSet>

    <changeSet id="8-2" author="azeem">
        <addColumn tableName="sip_plans">
            <column name="key_point1" type="VARCHAR(255)"/>
            <column name="key_point2" type="VARCHAR(255)"/>
            <column name="key_point3" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>

    <changeSet id="9" author="azeem">
        <createTable tableName="saving_plans">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="duration" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="amount" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="TEXT">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="9-1" author="azeem">
        <sql>
            ALTER TABLE saving_plans ADD CONSTRAINT chk_saving_plans_status
                CHECK (status IN ('ACTIVE','CLOSED'));
        </sql>
    </changeSet>

    <changeSet id="9-2" author="azeem">
        <addColumn tableName="saving_plans">
            <column name="key_point1" type="VARCHAR(255)"/>
            <column name="key_point2" type="VARCHAR(255)"/>
            <column name="key_point3" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>

    <changeSet id="10" author="azeem">
        <createTable tableName="gold_plant_schemes">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="duration" type="VARCHAR(100)"/>
            <column name="min_invest" type="VARCHAR(100)"/>
            <column name="status" type="VARCHAR(50)"/>
            <column name="description" type="TEXT"/>

        </createTable>
    </changeSet>

    <changeSet id="10-1" author="azeem">
        <sql>
            ALTER TABLE gold_plant_schemes ADD CONSTRAINT chk_gold_plant_schemes_status
                CHECK (status IN ('ACTIVE','CLOSED'));
        </sql>
    </changeSet>

    <changeSet id="10-2" author="azeem">
        <addColumn tableName="gold_plant_schemes">
            <column name="created_at" type="TIMESTAMP"/>
            <column name="updated_at" type="TIMESTAMP"/>
        </addColumn>
    </changeSet>

    <changeSet id="10-3" author="azeem">
        <addColumn tableName="gold_plant_schemes">
            <column name="key_point1" type="VARCHAR(255)"/>
            <column name="key_point2" type="VARCHAR(255)"/>
            <column name="key_point3" type="VARCHAR(255)"/>
        </addColumn>
    </changeSet>

    <changeSet id="11" author="azeem">
        <createTable tableName="campaigns">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
            <column name="description" type="TEXT"/>
            <column name="start_date" type="DATE"/>
            <column name="end_date" type="DATE"/>
            <column name="multiplier" type="VARCHAR(50)"/>
            <column name="status" type="VARCHAR(50)"/>
            <column name="created_at" type="TIMESTAMP"/>
            <column name="updated_at" type="TIMESTAMP"/>
        </createTable>
    </changeSet>

    <changeSet id="11-1" author="azeem">
        <sql>
            ALTER TABLE campaigns ADD CONSTRAINT chk_campaigns_status
                CHECK (status IN ('ACTIVE','INACTIVE','SCHEDULED'));
        </sql>
    </changeSet>

    <changeSet id="12" author="azeem">
        <createTable tableName="bank_accounts">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="bank" type="VARCHAR(255)"/>
            <column name="account" type="VARCHAR(255)"/>
            <column name="ifsc" type="VARCHAR(255)"/>
            <column name="status" type="VARCHAR(50)"/>
            <column name="description" type="TEXT"/>
            <column name="created_at" type="TIMESTAMP"/>
            <column name="updated_at" type="TIMESTAMP"/>
        </createTable>
    </changeSet>

    <changeSet id="12-1" author="azeem">
        <sql>
            ALTER TABLE bank_accounts ADD CONSTRAINT chk_bank_accounts_status
                CHECK (status IN ('ACTIVE','INACTIVE'));
        </sql>
    </changeSet>

    <changeSet id="13" author="azeem">
        <createTable tableName="faqs">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="question" type="TEXT"/>
            <column name="answer" type="TEXT"/>
            <column name="type" type="VARCHAR(50)"/>
            <column name="created_at" type="TIMESTAMP"/>
            <column name="updated_at" type="TIMESTAMP"/>
        </createTable>
    </changeSet>

    <changeSet id="13-1" author="azeem">
        <sql>
            ALTER TABLE faqs ADD CONSTRAINT chk_faqs_type
                CHECK (type IN ('HOME', 'CHIT', 'SIP', 'SCHEME'));
        </sql>
    </changeSet>


    <!-- B2B Profiles Table -->
    <changeSet id="14" author="azeem">
        <createTable tableName="b2b_profiles">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false" unique="true" foreignKeyName="fk_b2b_user" references="users(id)"/>
            </column>
            <column name="company_name" type="VARCHAR(255)"/>
            <column name="gstin" type="VARCHAR(15)"/>
            <column name="pan" type="VARCHAR(10)"/>
            <column name="address" type="TEXT"/>
            <column name="bank_account" type="VARCHAR(100)"/>
            <column name="upi" type="VARCHAR(100)"/>
            <column name="team_email" type="VARCHAR(255)"/>
            <column name="gst_certificate_url" type="TEXT"/>
            <column name="pan_card_url" type="TEXT"/>
            <column name="address_proof_url" type="TEXT"/>
            <column name="bank_statement_url" type="TEXT"/>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"/>
        </createTable>
    </changeSet>

    <!-- Wallets Table -->
    <changeSet id="15" author="azeem">
        <createTable tableName="wallets">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="balance" type="DECIMAL(15,2)" defaultValue="0.00">
                <constraints nullable="false"/>
            </column>
            <column name="credit_limit" type="DECIMAL(15,2)" defaultValue="0.00">
                <constraints nullable="false"/>
            </column>
            <column name="used_credit" type="DECIMAL(15,2)" defaultValue="0.00">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="updated_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint
                constraintName="fk_wallet_user"
                baseTableName="wallets"
                baseColumnNames="user_id"
                referencedTableName="users"
                referencedColumnNames="id"/>
    </changeSet>

    <!-- Wallet Transactions Table -->
    <changeSet id="16" author="azeem">
        <createTable tableName="wallet_transactions">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true"/>
            </column>
            <column name="wallet_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="amount" type="DECIMAL(15,2)">
                <constraints nullable="false"/>
            </column>
            <column name="payment_method" type="VARCHAR(50)"/>
            <column name="status" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addForeignKeyConstraint
                constraintName="fk_transaction_wallet"
                baseTableName="wallet_transactions"
                baseColumnNames="wallet_id"
                referencedTableName="wallets"
                referencedColumnNames="id"/>
    </changeSet>

    <!-- Add constraints for wallet_transactions -->
    <changeSet id="17" author="azeem">
        <sql>
            ALTER TABLE wallet_transactions ADD CONSTRAINT chk_transaction_type
                CHECK (type IN ('TOPUP', 'PURCHASE'));
            ALTER TABLE wallet_transactions ADD CONSTRAINT chk_transaction_status
                CHECK (status IN ('PENDING', 'COMPLETED', 'FAILED'));
        </sql>
    </changeSet>

    <!-- Gold Purchase Table -->
    <changeSet id="18" author="azeem">
        <createTable tableName="gold_purchase">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true"/>
            </column>
            <column name="rate_per_gram" type="NUMERIC(12,2)">
                <constraints nullable="false"/>
            </column>
            <column name="quantity" type="NUMERIC(12,2)">
                <constraints nullable="false"/>
            </column>
            <column name="delivery_type" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="payment_method" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="total_price" type="NUMERIC(14,2)">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(20)" defaultValue="PENDING">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="19" author="cseazeem">
        <createTable tableName="gold_purchase_orders">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="customer_name" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="customer_type" type="VARCHAR(10)">
                <constraints nullable="false"/>
            </column>
            <column name="quantity" type="DECIMAL(10,2)">
                <constraints nullable="false"/>
            </column>
            <column name="price_per_gram" type="DECIMAL(10,2)">
                <constraints nullable="false"/>
            </column>
            <column name="total_amount" type="DECIMAL(12,2)">
                <constraints nullable="false"/>
            </column>
            <column name="delivery_method" type="VARCHAR(20)">
                <constraints nullable="false"/>
            </column>
            <column name="payment_method" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(20)" defaultValue="PENDING">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="19-1" author="cseazeem">
        <sql>
            ALTER TABLE gold_purchase_orders
                ADD CONSTRAINT chk_customer_type
                    CHECK (customer_type IN ('USER', 'B2B'));
        </sql>
    </changeSet>

    <changeSet id="20-2" author="cseazeem">
        <sql>
            ALTER TABLE gold_purchase_orders
                ADD CONSTRAINT chk_order_status
                    CHECK (status IN ('PENDING', 'PROCESSING', 'COMPLETED', 'CANCELLED'));
        </sql>
    </changeSet>

    <changeSet id="21" author="azeem">
        <createTable tableName="support_tickets">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="user_id" type="BIGINT"/>
            <column name="subject" type="VARCHAR(255)"/>
            <column name="message" type="TEXT"/>
            <column name="status" type="VARCHAR(20)" defaultValue="OPEN"/>
            <column name="submitted_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"/>
            <column name="updated_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP"/>
        </createTable>
    </changeSet>

    <!-- Create sips table -->
    <changeSet id="22" author="cseazeem">
        <createTable tableName="sips">
            <column name="id" type="BIGSERIAL">
                <constraints primaryKey="true"/>
            </column>
            <column name="user_id" type="BIGINT">
                <constraints nullable="false" foreignKeyName="fk_sip_user" references="users(id)"/>
            </column>
            <column name="start_date" type="DATE">
                <constraints nullable="false"/>
            </column>
            <column name="amount" type="DOUBLE PRECISION">
                <constraints nullable="false"/>
            </column>
            <column name="duration" type="INTEGER">
                <constraints nullable="false"/>
            </column>
            <column name="plan" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="plan_name" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="VARCHAR(20)" defaultValue="Active">
                <constraints nullable="false"/>
            </column>
            <column name="commission" type="VARCHAR(20)" defaultValue="â‚¹0">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="updated_at" type="TIMESTAMP" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <!-- Add status constraint -->
    <changeSet id="23" author="cseazeem">
        <sql>
            ALTER TABLE sips ADD CONSTRAINT chk_sip_status
                CHECK (STATUS IN ('ACTIVE', 'CANCELLED', 'COMPLETED'));
        </sql>
    </changeSet>
</databaseChangeLog>
